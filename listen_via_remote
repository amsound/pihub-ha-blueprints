blueprint:
  name: Listen (via MQTT Activity)
  description: >-
    Discreet remote control intent. Selects a radio station and switches off tv (if on).
  domain: automation

  input:
    mqtt_topic_rx:
      name: MQTT Trigger Topic e.g. `pihub/kitchen/activity`
      description: ""
      selector:
        text:

    radio_station:
      name: Default Radio Station
      description: ""
      selector:
        text:

    radio_tuner_script:
      name: Music Assistant Radio Tuner Script
      description: ""
      selector:
        entity:
          domain: script

    tv_sensor:
      name: TV Sensor
      description: ""
      selector:
        entity:
          domain: binary_sensor

    mqtt_topic_tx:
      name: MQTT Command Topic e.g. `pihub/kitchen/cmd`
      description: ""
      selector:
        text:

triggers:
  - platform: mqtt
    topic: !input mqtt_topic_rx
    payload: "listen"

condition: []

actions:
  - action: !input radio_tuner_script
    data:
      station: !input radio_station

  - choose:
      - conditions:
          - condition: state
            entity_id: !input tv_sensor
            state: "on"
        sequence:
          - service: mqtt.publish
            data:
              topic: !input mqtt_topic_tx
              payload: macro:atv-off
              qos: 1
              retain: false

mode: single
